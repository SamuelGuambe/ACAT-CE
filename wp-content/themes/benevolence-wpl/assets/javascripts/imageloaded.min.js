!function(i,n){"use strict";"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(e,t){return n(i,e,t)}):"object"==typeof exports?module.exports=n(i,require("eventEmitter"),require("eventie")):i.imagesLoaded=n(i,i.EventEmitter,i.eventie)}(this,function(e,t,i){"use strict";var o=e.jQuery,s=e.console,h=void 0!==s;function r(e,t){for(var i in t)e[i]=t[i];return e}var c=Object.prototype.toString;function f(e){var t=[];if("[object Array]"===c.call(e))t=e;else if("number"==typeof e.length)for(var i=0,n=e.length;i<n;i++)t.push(e[i]);else t.push(e);return t}function a(e,t,i){if(!(this instanceof a))return new a(e,t);"string"==typeof e&&(e=document.querySelectorAll(e)),this.elements=f(e),this.options=r({},this.options),"function"==typeof t?i=t:r(this.options,t),i&&this.on("always",i),this.getImages(),o&&(this.jqDeferred=new o.Deferred);var n=this;setTimeout(function(){n.check()})}function n(e){this.img=e}(a.prototype=new t).options={},a.prototype.getImages=function(){this.images=[];for(var e=0,t=this.elements.length;e<t;e++){var i=this.elements[e];"IMG"===i.nodeName&&this.addImage(i);for(var n=i.querySelectorAll("img"),o=0,r=n.length;o<r;o++){var s=n[o];this.addImage(s)}}},a.prototype.addImage=function(e){e=new n(e);this.images.push(e)},a.prototype.check=function(){var i=this,n=0,o=this.images.length;if(this.hasAnyBroken=!1,o)for(var e=0;e<o;e++){var t=this.images[e];t.on("confirm",r),t.check()}else this.complete();function r(e,t){return i.options.debug&&h&&s.log("confirm",e,t),i.progress(e),++n===o&&i.complete(),!0}},a.prototype.progress=function(e){this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded;var t=this;setTimeout(function(){t.emit("progress",t,e),t.jqDeferred&&t.jqDeferred.notify&&t.jqDeferred.notify(t,e)})},a.prototype.complete=function(){var t=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var i=this;setTimeout(function(){var e;i.emit(t,i),i.emit("always",i),i.jqDeferred&&(e=i.hasAnyBroken?"reject":"resolve",i.jqDeferred[e](i))})},o&&(o.fn.imagesLoaded=function(e,t){return new a(this,e,t).jqDeferred.promise(o(this))}),(n.prototype=new t).check=function(){var i,e=u[this.img.src]||new d(this.img.src);e.isConfirmed?this.confirm(e.isLoaded,"cached was confirmed"):this.img.complete&&void 0!==this.img.naturalWidth?this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(i=this,e.on("confirm",function(e,t){return i.confirm(e.isLoaded,t),!0}),e.check())},n.prototype.confirm=function(e,t){this.isLoaded=e,this.emit("confirm",this,t)};var u={};function d(e){this.src=e,u[e]=this}return(d.prototype=new t).check=function(){var e;this.isChecked||(e=new Image,i.bind(e,"load",this),i.bind(e,"error",this),e.src=this.src,this.isChecked=!0)},d.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},d.prototype.onload=function(e){this.confirm(!0,"onload"),this.unbindProxyEvents(e)},d.prototype.onerror=function(e){this.confirm(!1,"onerror"),this.unbindProxyEvents(e)},d.prototype.confirm=function(e,t){this.isConfirmed=!0,this.isLoaded=e,this.emit("confirm",this,t)},d.prototype.unbindProxyEvents=function(e){i.unbind(e.target,"load",this),i.unbind(e.target,"error",this)},a});